# 论文分析
### SOFT-SLAM: Computationally efficient stereo VSLAM for UAVs
#### 整体思路
- 特征法，不过由于特征法较慢，为了追求高帧率使用了一些处理技巧
- 里程计环节:
1. [特征搜索以及匹配](#feature_matching)
2. [使用特征进行位姿估计](#pose_estimate)
3. [指数滤波（低通滤波）](#exp_filter)
- [建图环节](#map_building)：
1. 关键帧管理
2. 全图优化以及位姿图优化
3. 融合里程计信息进行回环检测
- 以上环节并没有过于高深的数学理论推导，但是要完全理解其方法还是存在一定难度（方法比较模糊）
#### 里程计实现细节
<span id="feature_matching">

##### 特征搜索以及匹配
- 检测图像上的corner（角点）以及blob（斑纹），并且使用局部的非极大抑制（也即邻近的几个相同特征选择最为明显的）
- 使用corner / blob 的卷积patch 对图像进行卷积处理 得到：
  - corner maxima：角点特征最突出的位置集
  - corner minima：角点特征最不突出的位置集（此处理解存在一些偏差：到底是最不突出还是被检测为角点特征但特征最弱位置？）
  - blob maxima & minima 意义类似
- 使用最小化SAD（sum of absolute difference）对两帧或者多帧图像间的特征进行匹配
  - 此处使用了一个闭环检测 对于双目两连续帧，一个特征需要在（本帧左->右）->（上一帧左->右）->本帧左 图像进行搜索
  - 只有全部搜索到的特征点才会被加入特征集。可以隐式地认为这种方法含有Markov性，毕竟我们上一次的特征点是**已经完成特征搜索以及匹配的inliers**，并且包括了历史帧的某些信息（上一帧存在的特征点将会出现在历史帧中）
  - 优点：对噪声以及outliers不敏感，缺点：很显然这减小了可用特征点的数目并且提升匹配了复杂度
  - 对特征点所在的patches(一簇像素)进行最小SAD的匹配（最小梯度误差）
  - 通过以上方式我们获得了特征点以及特征点与历史特征点的关系
- **RANSAC**处理
  - 在进行直接的特征点匹配后，必然是会存在很多outliers（匹配错误的点对，查RANSAC图像匹配，RANSAC前的图像即是）
  - SLAM中特征点匹配很常用，但是原理并没有深入了解
  - 单点RANSAC 3点RANSAC 以及5点RANSAC的区别？（有待查询论文`one-point RANSAC...`）
  - RANSAC 可以得到一组 inliers
- 亚像素特征点位置优化
- 记录某个特征点的初始特征 (initial descriptor)
- 稀疏化（让特征点组更加稀疏）并且记录特征点的`age`，对于过于老的特征我们将不倾向于保留（除非这个特征太棒了）
</span>
<span id="pose_estimate">

##### 使用特征进行位姿估计
- 特征匹配之后，就可以用对极约束了（这一部分还要自己手推一遍）
  - 对极约束用于恢复相机运动：p2'Ep1 = 0, 其中E = t^(反对称变换)@R
  - 我们有多对配对点，那么也就可以通过非线性优化，最小化重投影误差来解决
- 平滑：受到噪声的影响，很可能两个连续时间段求出的位姿存在突变的情况，而突变的运动 + 对相机系统的控制（比如云台）可能导致进一步的不稳定
  - 需要结合历史位姿进行slerp，使用历史帧进行平滑
  - t也是最小化重投影误差得到的
- 而存在IMU信息时，运动的恢复可以做信息融合
  - IMU信息 + 匹配信息（这个可能对应置信度较低）
</span>

<span id="exp_filter">

##### 指数滤波器
- 作为一个low-pass filter 使用的，防止位姿突变导致的控制不稳（正反馈地影响整个控制系统）
- 也是使用历史运动进行优化 slerp
</span>
---
<span id="map_building">

##### 关键帧管理
- 关键帧选取：本帧进行判断（使用已知的特征点，恢复了运动，得到了自身位姿）
  - 判断位姿是否与其他关键帧的位姿具有高相似性
  - 设置阈值：当旋转或者平移中有一项与其他关键帧位姿差别较大，则保存为关键帧
- **关键帧的具体作用还需要进一步学习**
- **对于后端和建图的理解还不深**

</span>