# 论文总结
### Visual-lidar Odometry and Mapping: Low-drift, Robust, and Fast (KITTI 榜 #1)
#### 提要
- 视觉里程计(VO) 是依靠视觉的方式进行**相对位置**的计算
- 相对位置再怎么优化都是会漂移的，所以我们需要全局的**定位(Localization)**
- 自动驾驶以及其他与之相关的课题的重点都应该是Localization而不是Odometry
- KITTI榜上的方法是否过拟合？
- 这篇文章作为 视觉里程计的入门了解
- 主要体会建模以及计算的方法以及思路
#### 主要思路
- 结合激光雷达以及单目视觉
  - 单目视觉提供视觉特征，用于高帧率地计算传感器的运动（Motion Estimation）
  - 激光雷达用于获取准确的，带深度信息的点云，以此为建图的基础
- 视觉与雷达各自的缺陷
  - 雷达频率较慢，并且在雷达进行扫描时，由于存在自身运动 (ego-motion)的原因，点云会出现失真的情况
  - 单目视觉靠SfM的方式进行深度估计仍然是比较困难的，稀疏的视觉特征建图受到了限制
- 视觉与雷达的相互作用
  - 视觉帧率较高，依靠视觉进行自身运动的估计能得到较好的结果，对于快速变化的运动状态（如加减速，急转）都会比从激光数据上估计来的更好
  - 这篇论文中，运动的估计就没有使用到运动传感器，假如可以在这方面进行信息融合将更加准确
    - 但是假设视觉只做这一件事（传感器的运动估计），岂不是没什么太大用处？
    - 对的 VO就是光以视觉（当然这篇文章有激光雷达辅助）当里程计
    - 完全可以使用IMU，虽然好的IMU价格也很高
    - 我们最后要达到的目的是**无激光雷达 无昂贵IMU**？
  - 激光能给视觉提供深度信息，并且存在点云数据时，可以帮助视觉进行特征上的匹配
  - 视觉产生的运动信息用于修复激光雷达长扫描时间产生的漂移点云
#### 建模与计算
- VO 基本步骤：
  1. 获取图像进行处理：特征点检测
  2. 每个特征点从Lidar的点云图中获取
  3. 与历史帧中的特征点进行匹配
  4. 进行运动估计
- Lidar 基本步骤：
  1. 点云的配准
  2. 使用线性模型对VO的漂移进行修正
  3. 融合历史点云与观测点云
- VO 建模细节：
  - 注意我们不是通过每个特征点的三维位置来直接获得运动信息
  - 为什么说不是直接通过三维点的位置？
    - 历史帧上的有些点深度未知
    - 注意每一次的 VO 都是在Lidar之前，VO使用历史的Lidar点云进行深度匹配，VO 的结果提供给Lidar
    - 于是在VO发生作用时，每个特征点的深度只能来自于历史帧
  - 我们需要的传感器运动是Lidar两次Sweep之间的R与T
  - 有了R与T以及时间，角速度可以通过slerp求解，T可以通过差分近似
  - 明确了问题（求解R, T）注意到，信息是冗余的（特征点虽然不是稠密的，但是相对于运动6自由度而言完全冗余）
    - 我们需要约束方程，尝试解一个非线性优化问题
    - 论文通过巧妙的消元法：深度是未知的，此处的深度实际上是`distance`, 也就是sqrt(x^2 + y^2 + z^2)
    - 那么每个点可以由归一化坐标表示（此处的归一化坐标是什么？）`定义是模为1的三维点，但是深度未知怎么求x，y分量？`
    - 实际上可以用坐标变换（相机模型，得到归一化平面坐标，这实际上可以通过再次归一化等价于归一化坐标（模归一化））
  - 两种情况：
    1. 历史的特征点三维坐标已知，那么我们不需要消去历史帧中的（未知量深度），消去一个未知量（变量代换）需要消耗一个方程，本身由于是三维约束，有三个方程。我们只需要消去本帧中的深度变量（很简单的推导）
    2. 历史点深度未知，那么由于要消去本帧深度，历史深度，需要消耗两个方程
    3. 综上，已知历史深度的一个特征点会提供两个方程，未知则提供一个方程
    4. 通过所有特征点，我们得到一堆方程，没办法解，只能用非线性优化
    5. LM法求出最佳的R,T，同时！**注意算法中一定要包含异常点检测，我们用鲁棒算法如RANSAC或者鲁棒权重：离群点赋0权，残差较大点赋小权**
  - 加速的考虑：KD-树
  - 最邻近搜索：特征点如何匹配对应深度？
  - 很简单的想法：三维点根据位姿（已经求出来了！）投影到二维图像上
  - 二维图像的特征点搜索三个最邻近的深度投影点
    - 三点确定一个平面，深度的求法：光束法：从相机中心发出光束通过平面的中心，得到空间三点插值距离？
  - 可能存在某些点无法求出深度（比如周围的深度点十分稀疏）
    - 这时我们使用SfM，假如这个特征点在历史帧中被连续观测到了
    - 那么可以通过运动，对极几何得到（三角法）
- Lidar（点云配准等）建模细节
  - 匀速漂移假设（假设误差是均匀的，那么漂移随着时间就是线性关系）
  - 从点云中提取特征：
    - 边缘特征以及平面特征（大范围平面可以进行点数削减）
  - 视觉里程计漂移 T 是如何影响点云的
    - 点云中的某些点是在同一时间被扫描出来的，但在这一时间，视觉里程计的运动估计已经出现漂移了
    - 那么我们做的到世界坐标系下的变换也会出现漂移（失真）
  - 论文使用线性(6*1)的漂移模型进行讨论
  - 有一个很明显的道理：在世界坐标系下，历史与当前的点云中匹配的点位置应该一致
  - 历史中的点我们认为已经优化过了，接近真值，那么当前点云中的点由于存在漂移，匹配点出现位置偏移
  - 那么根据历史-当前的点云点关系 可以得到一个`匹配点间的距离` 我们对这个距离进行优化
  - 非线性优化 LM 当匹配点距离最优化（最小）时对应的漂移就是我们模型对应的漂移
  - 使用这个最优的漂移计算值可以消除点云漂移
  - 最后当前点云与历史点云融合成当前的Map
    - 其中有一个很妙的地方：点云是稠密的，匹配不能用搜索，应该用矩阵优化
    - 一个大特征值 + 两个小特征值对应边缘线
    - 一个小特征值 + 两个大特征值对应平面
  - 我觉得挺好理解的，特征向量之间是线性无关的（基）
  - 大特征值对应的特征向量能基本决定方向
  - 那么一个单方向的基在空间中确定一条直线，两个线性无关基在空间中的线性组合组成平面
  - 至于小特征值对应的特征向量？我觉得可能就是起微调或者修正作用吧
- 总的来说就是做了一个信息融合

#### TODO
- [ ] KD-树
- [ ] LM 法的手写体会